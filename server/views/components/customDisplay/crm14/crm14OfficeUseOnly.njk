{% from "../../formField.njk" import formField %}
{% from "../../formSubsection.njk" import formSubsection %}
{% from "../../formTable.njk" import formTable %}

{% macro crm14OfficeUseOnly(data) %}

    {# Benefit Check Section #}
    {% set fieldsBenefitCheck = [
        { label: "Overall Check", value: data.benefitCheck.dwpOverallCheck },
        { label: "Result Refer To", value: data.benefitCheck.dwpResultReferTo },
        { label: "Check Surname", value: data.benefitCheck.dwpCheckSurname },
        { label: "Check NINO", value: data.benefitCheck.dwpCheckNino },
        { label: "Check Benefit To Repeat", value: data.benefitCheck.dwpCheckBenefitCheckToRepeat },
        { label: "Partner Surname", value: data.benefitCheck.dwpCheckPartnerSurname },
        { label: "Partner NINO", value: data.benefitCheck.dwpCheckPartnerNino }
    ] %}
    {{ formSubsection('Benefit Check', fieldsBenefitCheck) }}

    {# Message History Section #}
    {% if data.messageHistory.length > 0 %}
        {% set tableMessageHistory = {
            head: [],
            rows: []
        } %}

        {% for key, label in {
            senderDisplay: "Sender",
            message: "Message",
            senderUniqueName: "Sender Unique Name",
            date: "Date"
        } %}
            {% if data.messageHistory[0][key] %}
                {% set _ = tableMessageHistory.head.push({ text: label }) %}
            {% endif %}
        {% endfor %}

        {% for message in data.messageHistory %}
            {% set tableRow = [] %}
            {% for key, _ in {
                senderDisplay: "Sender",
                message: "Message",
                senderUniqueName: "Sender Unique Name",
                date: "Date"
            } %}
                {% if message[key] %}
                    {% set _ = tableRow.push({ text: message[key] }) %}
                {% endif %}
            {% endfor %}
            {% set _ = tableMessageHistory.rows.push(tableRow) %}
        {% endfor %}

        {{ formSubsection('Message History', tableMessageHistory, true) }}
    {% endif %}

    {# Return Provider Section #}
    {% set fieldsReturnProvider = [
        { label: "Return Reason", value: data.returnProvider.returnReason },
        { label: "Return Reason Details", value: data.returnProvider.returnReasonDetails }
    ] %}
    {{ formSubsection('Return Provider', fieldsReturnProvider) }}

    {# Funding Decisions Section #}
    {% if data.fundingDecisions.length > 0 %}
        {% set tableFundingDecisions = {
            head: [],
            rows: []
        } %}

        {% for key, label in {
            maatNumber: "MAAT Number",
            caseNumber: "Case Number",
            justiceTest: "Justice Test",
            meansTestResultType: "Means Test Result Type",
            officialSignName: "Official Sign Name",
            appropriateOfficerName: "Appropriate Officer Name",
            justiceTestReasons: "Justice Test Reasons",
            overallResultMagsorcfs: "Overall Result Mags/CCFS",
            meansTestResultAppealtocc: "Means Test Appeal to CC",
            overallResultNonMeans: "Overall Non-Means Result",
            meansTestResultMagsorcfs: "Means Test Result Mags/CCFS",
            meansTestResultCc: "Means Test Result CC",
            overallResultAppealtocc: "Overall Appeal to CC",
            overallResultType: "Overall Result Type",
            overallResultCc: "Overall Result CC"
        } %}
            {% if data.fundingDecisions[0][key] %}
                {% set _ = tableFundingDecisions.head.push({ text: label }) %}
            {% endif %}
        {% endfor %}

        {% for decision in data.fundingDecisions %}
            {% set tableRow = [] %}
            {% for key, _ in {
                maatNumber: "MAAT Number",
                caseNumber: "Case Number",
                justiceTest: "Justice Test",
                meansTestResultType: "Means Test Result Type",
                officialSignName: "Official Sign Name",
                appropriateOfficerName: "Appropriate Officer Name",
                justiceTestReasons: "Justice Test Reasons",
                overallResultMagsorcfs: "Overall Result Mags/CCFS",
                meansTestResultAppealtocc: "Means Test Appeal to CC",
                overallResultNonMeans: "Overall Non-Means Result",
                meansTestResultMagsorcfs: "Means Test Result Mags/CCFS",
                meansTestResultCc: "Means Test Result CC",
                overallResultAppealtocc: "Overall Appeal to CC",
                overallResultType: "Overall Result Type",
                overallResultCc: "Overall Result CC"
            } %}
                {% if decision[key] %}
                    {% set _ = tableRow.push({ text: decision[key] }) %}
                {% endif %}
            {% endfor %}
            {% set _ = tableFundingDecisions.rows.push(tableRow) %}
        {% endfor %}

        {{ formSubsection('Funding Decisions', tableFundingDecisions, true) }}
    {% endif %}

{% endmacro %}