{% from "../../formFieldList.njk" import formFieldList %}
{% from "../../formTable.njk" import formTable %}

{% macro crm15Income2(data) %}

    <div class="govuk-form-group govuk-summary-card govuk-!-margin-bottom-6">
        <div class="govuk-summary-card__title-wrapper">
            <h3 class="govuk-summary-card__title">Your Income and Your Partner's Income</h3>
        </div>
        <div class="govuk-summary-card__content">
            <p class="govuk-body govuk-!-font-weight-bold">Do you or your partner receive the State Pension or any of
                the Benefits listed here?</p>
            <ul class="govuk-list govuk-list--bullet">
                <li>State Pension</li>
                <li>Child Benefit</li>
                <li>Working Tax Credit or Child Tax Credit</li>
                <li>Universal Credit</li>
                <li>Incapacity Benefit</li>
                <li>Industrial Injuries Disablement Benefit</li>
                <li>Contribution-based Job Seekers Allowance</li>
                <li>Other Benefits (except Housing Benefit)</li>
            </ul>
            {% set fields = [
                { label: 'You', value: data.receivingBenefits2 },
                { label: 'Your Partner', value: data.partnerReceivingBenefits2 }
            ] %}
            {{ formFieldList(fields) }}

            {% set benefitsData = [
                {label: 'State Pension', amount: data.statePensionCrm15, every: data.statePensionCrm15PaidEvery },
                {label: 'Child Benefit', amount: data.childBenefitCrm15, every: data.childBenefitCrm15PaidEvery },
                {label: 'Working Tax Credit or Child Tax Credit', amount: data.taxCreditCrm15, every: data.taxCreditCrm15PaidEvery },
                {label: 'Universal Credit', amount: data.universalCreditCrm15, every: data.universalCreditCrm15PaidEvery },
                {label: 'Incapacity Benefit', amount: data.incapacityBenefitCrm15, every: data.incapacityBenefitCrm15PaidEvery },
                {label: 'Industrial Injuries Disablement Benefit', amount: data.disablementBenefitCrm15, every: data.disablementBenefitCrm15PaidEvery },
                {label: 'Contribution-based Job Seekers Allowance', amount: data.jsaCrm15, every: data.jsaCrm15PaidEvery },
                {label: 'Other Benefits (except Housing Benefit)', amount: data.otherBenefitsCrm15, every: data.otherBenefitsCrm15PaidEvery, details: data.otherBenefitsCrm15Details }
            ] %}
            {{ benefitsTable('You:', benefitsData) }}

            {% set benefitsData = [
                {label: 'State Pension', amount: data.partnerStatePensionCrm15, every: data.partnerStatePensionCrm15PaidEvery },
                {label: 'Child Benefit', amount: data.partnerChildBenefitCrm15, every: data.partnerChildBenefitCrm15PaidEvery },
                {label: 'Working Tax Credit or Child Tax Credit', amount: data.partnerTaxCreditCrm15, every: data.partnerTaxCreditCrm15PaidEvery },
                {label: 'Universal Credit', amount: data.partnerUniversalCreditCrm15, every: data.partnerUniversalCreditCrm15PaidEvery },
                {label: 'Incapacity Benefit', amount: data.partnerIncapacityBenefitCrm15, every: data.partnerIncapacityBenefitCrm15PaidEvery },
                {label: 'Industrial Injuries Disablement Benefit', amount: data.partnerDisablementBenefitCrm15, every: data.partnerDisablementBenefitCrm15PaidEvery },
                {label: 'Contribution-based Job Seekers Allowance', amount: data.partnerJsaCrm15, every: data.partnerJsaCrm15PaidEvery },
                {label: 'Other Benefits (except Housing Benefit)', amount: data.partnerOtherBenefitsCrm15, every: data.partnerOtherBenefitsCrm15PaidEvery , details: data.partnerOtherBenefitsCrm15Details }
            ] %}
            {{ benefitsTable('Your Partner:', benefitsData) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">At their next birthday, how many
                children living with you will be aged</p>
            {% set fields = [
                { label: '1 year', value: data.year1 },
                { label: '2 to 4', value: data.year2to4 },
                { label: '5 to 7', value: data.year5to7 },
                { label: '8 to 10', value: data.year8to10 },
                { label: '11 to 12', value: data.year11to12 },
                { label: '13 to 15', value: data.year13to15 },
                { label: '16 to 18', value: data.year16to18 }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">Do you or your partner receive a private pension, or a pension from an employer?</p>
            {% set fields = [
                { label: 'You', value: data.receivePension  },
                { label: 'Your Partner', value: data.partnerReceivePension}
            ] %}
            {{ formFieldList(fields) }}

            {{ amountEvery('You:', data.totalPension, data.totalPensionPaidEvery) }}

            {{ amountEvery('Your Partner:', data.partnerTotalPension, data.partnerTotalPensionPaidEvery) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">Do you or your partner receive maintenance payments for anyone in your household?</p>
            {% set fields = [
                { label: 'You', value: data.receiveMaintenancePayments },
                { label: 'Your Partner', value: data.partnerReceiveMaintenancePayments }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">You:</p>
            {% set fields = [
                { label: 'amount', value: data.maintenancePayment },
                { label: 'every', value: data.maintenancePaymentPaidEvery }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">Your Partner:</p>
            {% set fields = [
                { label: 'amount', value: data.partnerMaintenance },
                { label: 'every', value: data.partnerMaintenancePaymentPaidEvery }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">Do you or your partner receive interest or income from any savings or other investment?</p>
            {% set fields = [
                { label: 'You', value: data.receiveInterest },
                { label: 'Your Partner', value: data.partnerReceiveInterest }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">You:</p>
            {% set fields = [
                { label: 'amount', value: data.interest },
                { label: 'every', value: data.partnerInterestPaidEvery }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">Your Partner:</p>
            {% set fields = [
                { label: 'amount', value: data.partnerInterest },
                { label: 'every', value: data.partnerInterestPaidEvery }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">Do you or your partner receive any income from the sources listed here?</p>
            <ul class="govuk-list govuk-list--bullet">
                <li>Student grant or loan</li>
                <li>Board or rent from a family lodger or tenant</li>
                <li>Rent from another property</li>
                <li>Financial support from anyone else or from someone who allows you to use assets or money</li>
                <li>Income from any other source which you have not stated in any of the previous questions</li>
            </ul>
            {% set fields = [
                { label: 'You', value: data.incomeFromOtherSources },
                { label: 'Your Partner', value: data.partnerIncomeFromOtherSources }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">You:</p>
            {% set fields = [
                { label: 'Student grant or loan', value: data.studentLoan },
                { label: 'Board or rent from a family lodger or tenant', value: otherRent.familyRent },
                { label: 'Rent from another property', value: data.partnerOtherRent },
                { label: 'Financial support from anyone else or from someone who allows you to use assets or money', value: data.otherFinancialSupport },
                { label: 'Income from any other source which you have not stated in any of the previous questions. Please explain', value: data.otherIncomeSourceFreetext }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold">The total amount received from all sources in this question</p>
            {% set fields = [
                { label: 'amount', value: data.totalAmountReceived },
                { label: 'every', value: data.totalAmountReceivedEvery }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">Your Partner:</p>
            {% set fields = [
                { label: 'Student grant or loan', value: data.partnerStudentLoan },
                { label: 'Board or rent from a family lodger or tenant', value: data.partnerFamilyRent },
                { label: 'Rent from another property', value: data.partnerOtherRent },
                { label: 'Financial support from anyone else or from someone who allows you to use assets or money', value: data.partnerOtherFinancialSupport },
                { label: 'Income from any other source which you have not stated in any of the previous questions. Please explain', value: data.partnerOtherIncomeSourceFreetext }
            ] %}
            {{ formFieldList(fields) }}

            <p class="govuk-body govuk-!-font-weight-bold">The total amount received from all sources in this question</p>
            {% set fields = [
                { label: 'amount', value: data.partnerTotalAmountReceived },
                { label: 'every', value: data.partnerTotalAmountReceivedEvery }
            ] %}
            {{ formFieldList(fields) }}

            {% set fields = [
                { label: 'Do your answers to the previous questions tell us that you have no income from any of the sources which we have asked about?', value: data.prevAnswersNoOtherIncome },
                { label: 'How do you and your partner pay your bills and daily expenses?', value: data.howPayBillsCrm15 }
            ] %}
            {{ formFieldList(fields) }}
        </div>
    </div>
{% endmacro %}


{% macro benefitsTable(title, data) %}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">{{ title }}</p>
    {% set tableData = {
        head: [],
        rows: []
    } %}

    {% for item in data %}

        {% if item.details %}
            {% set details = 'amount ' + (item.amount | formatCurrency) + '<p>The benefit: </p><p>' + item.details + '</p>' %}
        {% else %}
            {% set details = 'amount ' + (item.amount | formatCurrency) %}
        {% endif %}

        {%- set tableRow = [
            { text: item.label },
            { text: details | safe },
            { text: 'every ' + (item.every | default('1 week', true) | safe) }
        ] -%}
        {% set list = tableData.rows.push(tableRow) %}
    {% endfor %}

    {{ formTable(tableData) }}
{% endmacro %}


{% macro amountEvery(label, amount, every) %}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-top-4">{{ label }}</p>
    {% set fields = [
        { label: 'amount', value: amount },
        { label: 'every', value: every }
    ] %}
    {{ formFieldList(fields) }}
{% endmacro %}