{% extends "../partials/layout.njk" %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "../components/backLink.njk" import backLink %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}

{% set pageTitle = applicationName + " - Generate Reports" %}
{% set mainClasses = "app-container govuk-body" %}

{% block content %}
    <div class="govuk-width-container">
        {{ backLink(backUrl) }}
        <main class="govuk-main-wrapper">

            {% if downloadUrl %}
                <input type="hidden" id="download-url" value="{{ downloadUrl }}">
            {% endif %}

            <!-- Display success message -->
            {% if successMessage %}
                {{ govukNotificationBanner({
                    titleText: "Success",
                    text: successMessage,
                    type: "success"
                }) }}
            {% endif %}

            {% if errors.list | length %}
                {{ govukErrorSummary({
                    titleText: "There is a problem",
                    errorList: errors.list
                }) }}
            {% endif %}

            <h1 class="govuk-heading-l">Generate reports</h1>
            <h2 class="govuk-heading-m govuk-!-margin-bottom-1">Search by</h2>
            <span class="govuk-caption-m govuk-!-margin-bottom-4">To generate reports, choose the CRM type that you would like to generate and attribute it a date range.</span>

            <div class="form-background govuk-!-padding-top-4 govuk-!-padding-left-4">
                <form action="/generate-report" method="POST">
                    <div class="govuk-grid-row">
                        <div class="govuk-grid-column-one-half">
                            {{ govukSelect({
                                id: "crm-type",
                                name: "crmType",
                                value: formValues.crmType,
                                errorMessage: errors.messages.crmType,
                                label: {
                                    text: "CRM type"
                                },
                                items: [
                                    {
                                        value: "",
                                        text: "Choose CRM type",
                                        selected: true
                                    },
                                    {
                                        value: "crm4",
                                        text: "CRM 4"
                                    },
                                    {
                                        value: "crm5",
                                        text: "CRM 5"
                                    },
                                    {
                                        value: "crm14",
                                        text: "CRM 14"
                                    }
                                ]
                            }) }}
                        </div>
                    </div>
                    <div class="govuk-grid-row">
                        <div class="govuk-grid-column-one-quarter">
                            {{ govukInput({
                                label: {
                                    text: "Decision date from"
                                },
                                id: "decision-from-date",
                                name: "decisionFromDate",
                                value: formValues.decisionFromDate,
                                type: "date",
                                errorMessage: errors.messages.decisionFromDate
                            }) }}
                        </div>
                        <div class="govuk-grid-column-one-quarter">
                            {{ govukInput({
                                label: {
                                    text: "Decision date to"
                                },
                                classes: "govuk-!-width-full",
                                id: "decision-to-date",
                                name: "decisionToDate",
                                value: formValues.decisionToDate,
                                type: "date",
                                errorMessage: errors.messages.decisionToDate
                            }) }}
                        </div>
                    </div>
                    <div id="crm14Container"
                         class="{% if formValues.crmType !== 'crm14' %}hideContainer{% endif %}">
                        <div class="govuk-grid-row">
                            <div class="govuk-grid-column-one-quarter">
                                {{ govukInput({
                                    label: {
                                        text: "Submitted date from"
                                    },
                                    id: "submitted-from-date",
                                    name: "submittedFromDate",
                                    value: formValues.submittedFromDate,
                                    type: "date",
                                    errorMessage: errors.messages.submittedFromDate
                                }) }}
                            </div>
                            <div class="govuk-grid-column-one-quarter">
                                {{ govukInput({
                                    label: {
                                        text: "Submitted date to"
                                    },
                                    classes: "govuk-!-width-full",
                                    id: "submitted-to-date",
                                    name: "submittedToDate",
                                    value: formValues.submittedToDate,
                                    type: "date",
                                    errorMessage: errors.messages.submittedToDate
                                }) }}
                            </div>
                        </div>
                        <div class="govuk-grid-row">
                            <div class="govuk-grid-column-one-quarter">
                                {{ govukInput({
                                    label: {
                                        text: "Created date from"
                                    },
                                    id: "created-from-date",
                                    name: "createdFromDate",
                                    value: formValues.createdFromDate,
                                    type: "date",
                                    errorMessage: errors.messages.createdFromDate
                                }) }}
                            </div>
                            <div class="govuk-grid-column-one-quarter">
                                {{ govukInput({
                                    label: {
                                        text: "Created date to"
                                    },
                                    classes: "govuk-!-width-full",
                                    id: "created-to-date",
                                    name: "createdToDate",
                                    value: formValues.createdToDate,
                                    type: "date",
                                    errorMessage: errors.messages.createdToDate
                                }) }}
                            </div>
                        </div>
                        <div class="govuk-grid-row">
                            <div class="govuk-grid-column-one-quarter">
                                {{ govukInput({
                                    label: {
                                        text: "Last submitted date from"
                                    },
                                    id: "last-submitted-from-date",
                                    name: "lastSubmittedFromDate",
                                    value: formValues.lastSubmittedFromDate,
                                    type: "date",
                                    errorMessage: errors.messages.lastSubmittedFromDate
                                }) }}
                            </div>
                            <div class="govuk-grid-column-one-quarter">
                                {{ govukInput({
                                    label: {
                                        text: "Last submitted date to"
                                    },
                                    classes: "govuk-!-width-full",
                                    id: "last-submitted-to-date",
                                    name: "lastSubmittedToDate",
                                    value: formValues.lastSubmittedToDate,
                                    type: "date",
                                    errorMessage: errors.messages.lastSubmittedToDate
                                }) }}
                            </div>
                        </div>
                    </div>
                    <div class="govuk-grid-row">
                        <div class="govuk-grid-column-full">
                            <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
                            {{ govukButton({
                                action: '#',
                                method: 'post',
                                text: 'Download report'
                            }) }}
                        </div>
                    </div>
                </form>
            </div>
        </main>
    </div>
{% endblock %}
{% block pageScripts %}
    <script src="/assets/generateReport.js"></script>
{% endblock %}